<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>SkinAI Classifier â€” Login</title>

    <!-- Match this path to your project structure -->
    <link rel="stylesheet" href="styles/styles.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap"
      rel="stylesheet">
  </head>
  <body>
    <!-- Header / Nav -->
    <header class="site-header" role="banner">
      <div class="container header-inner">
        <a class="brand" href="index.html" aria-label="SkinAI Classifier Home">
          <div class="brand-mark" aria-hidden="true">AI</div>
          <div class="brand-text">
            <strong>SkinAI Classifier</strong>
            <span>Purdue University</span>
          </div>
        </a>
        <nav class="nav" aria-label="Primary">
          <a href="index.html" class="nav-link">Home</a>
          <a href="upload.html" class="nav-link">Upload</a>
          <a href="reports.html" class="nav-link">Reports</a>
          <a href="team.html" class="nav-link">About Us</a>
          <a href="login.html" class="nav-link">Login</a>
        </nav>

      </div>
    </header>

    <!-- Main -->
    <main class="container narrow">
      <section class="section-pad" aria-labelledby="login-title">
        <h1 id="login-title" class="h-title">Login</h1>
        <p class="muted">Sign in to access your saved analysis reports.</p>

        <div class="card" role="region" aria-label="Login form">
          <form id="login-form" autocomplete="on" novalidate>
            <div style="display:grid; gap:12px; max-width:420px">
              <label>
                <span style="display:block; margin-bottom:6px;">Email</span>
                <input
                  id="email"
                  name="email"
                  type="email"
                  placeholder="you@pfw.edu"
                  required
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid #2a2a2a;background:#0f0f0f;color:#ededed" />
              </label>

              <label>
                <span style="display:block; margin-bottom:6px;">Password</span>
                <input
                  id="password"
                  name="password"
                  type="password"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  required
                  minlength="6"
                  style="width:100%;padding:10px;border-radius:8px;border:1px solid #2a2a2a;background:#0f0f0f;color:#ededed" />
              </label>

              <button type="submit" class="btn btn-cta">Sign In</button>
              <p id="login-msg" class="muted" aria-live="polite"
                style="margin-top:4px;"></p>

              <div
                style="margin-top:16px;padding-top:16px;border-top:1px solid #2a2a2a;">
                <p class="muted" style="text-align:center;">Don't have an
                  account? <a href="#" id="signup-link"
                    style="color:#4dabf7;text-decoration:none;">Sign up</a></p>
              </div>
            </div>
          </form>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="site-footer" role="contentinfo">
      <div class="container">
        <p class="footnote">Â© <span id="year"></span> SkinAI Classifier Â· Senior
          Capstone Project Â· For demonstration only.</p>
      </div>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Safely set year
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();

      const form = document.getElementById('login-form');
      const email = document.getElementById('email');
      const password = document.getElementById('password');
      const msg = document.getElementById('login-msg');
      const submitBtn = form.querySelector('button[type="submit"]');
      const signupLink = document.getElementById('signup-link');
      
      let isSignupMode = false;

      if (!form || !email || !password) {
        console.error('Login form elements not found.');
        return;
      }

      // Toggle between login and signup
      if (signupLink) {
        signupLink.addEventListener('click', (e) => {
          e.preventDefault();
          isSignupMode = !isSignupMode;
          
          if (isSignupMode) {
            submitBtn.textContent = 'Create Account';
            signupLink.textContent = 'Already have an account? Sign in';
            document.getElementById('login-title').textContent = 'Sign Up';
          } else {
            submitBtn.textContent = 'Sign In';
            signupLink.textContent = 'Sign up';
            document.getElementById('login-title').textContent = 'Login';
          }
          
          msg.textContent = '';
          email.value = '';
          password.value = '';
        });
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Basic client-side validation
        if (!email.value || !password.value) {
          if (msg) {
            msg.textContent = 'Please enter your email and password.';
            msg.style.color = '#ff6b6b';
          }
          return;
        }

        if (password.value.length < 6) {
          if (msg) {
            msg.textContent = 'Password must be at least 6 characters.';
            msg.style.color = '#ff6b6b';
          }
          return;
        }

        if (msg) {
          msg.textContent = isSignupMode ? 'Creating accountâ€¦' : 'Signing inâ€¦';
          msg.style.color = '#4dabf7';
        }

        try {
          const endpoint = isSignupMode ? '/api/auth/register' : '/api/auth/login';
          
          // Call backend API
          const response = await fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              email: email.value.trim(),
              password: password.value,
            }),
          });

          const data = await response.json();

          if (response.ok) {
            // Store user in localStorage
            localStorage.setItem('skinai_user', data.email);
            
            if (msg) {
              msg.textContent = isSignupMode ? 'Account created successfully!' : 'Login successful!';
              msg.style.color = '#51cf66';
            }

            // Redirect after success
            const params = new URLSearchParams(window.location.search);
            const next = params.get('next') || 'reports.html';

            setTimeout(() => {
              window.location.href = next;
            }, 500);
          } else {
            // Show error message
            if (msg) {
              msg.textContent = data.error || (isSignupMode ? 'Signup failed.' : 'Login failed.');
              msg.style.color = '#ff6b6b';
            }
          }
        } catch (error) {
          console.error('Auth error:', error);
          if (msg) {
            msg.textContent = 'Connection error. Please try again.';
            msg.style.color = '#ff6b6b';
          }
        }
      });
    });
  </script>
  </body>

  <!-- Floating Chatbot Widget -->
  <div id="chatbot-widget">
    <div id="chatbot-button">
      <span class="chat-icon">ðŸ’¬</span>
      <span class="chat-label">Talk to AI Agent</span>
    </div>

    <div id="chatbot-window">
      <div id="chatbot-header">
        <span>Talk to AI Agent</span>
        <button id="chatbot-close">âœ•</button>
      </div>

      <div id="chatbot-messages"></div>

      <div id="chatbot-input-area">
        <input id="chatbot-input" type="text"
          placeholder="Type your messageâ€¦" />
        <button id="chatbot-send">âž¤</button>
      </div>
    </div>
  </div>

  <script src="scripts/chatbot.js"></script>

</html>
